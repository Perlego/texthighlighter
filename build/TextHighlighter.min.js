!function o(l,a,s){function f(t,e){if(!a[t]){if(!l[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};l[t][0].call(i.exports,function(e){return f(l[t][1][e]||e)},i,i.exports,o,l,a,s)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)f(s[e]);return f}({1:[function(r,e,t){(function(e){"use strict";var t,n=(t=r("./text-highlighter"))&&t.__esModule?t:{default:t};r("./jquery-plugin"),e.TextHighlighter=n.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./jquery-plugin":2,"./text-highlighter":3}],2:[function(e,t,n){"use strict";var r,i;"undefined"!=typeof jQuery&&(r=jQuery,i="textHighlighter",r.fn.textHighlighter=function(e){return this.each(function(){var t,n=this;r.data(n,i)||((t=new TextHighlighter(n,e)).destroy=function(e,t){return function(){t.call(this,e)}}(t.destroy,function(e){e.call(t),r(n).removeData(i)}),r.data(n,i,t))})},r.fn.getHighlighter=function(){return this.data(i)})},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.IGNORE_TAGS=n.END_OFFSET_ATTR=n.START_OFFSET_ATTR=n.TIMESTAMP_ATTR=n.DATA_ATTR=void 0;var p=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}}(e("./utils/dom")),r=e("./utils/events"),v=e("./utils/highlights"),i=e("./utils/arrays");function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(n,!0).forEach(function(e){a(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c="data-highlighted";n.DATA_ATTR=c;var d="data-timestamp";n.TIMESTAMP_ATTR=d;var N="data-start-offset";n.START_OFFSET_ATTR=N;var T="data-end-offset";n.END_OFFSET_ATTR=T;var h=["SCRIPT","STYLE","SELECT","OPTION","BUTTON","OBJECT","APPLET","VIDEO","AUDIO","CANVAS","EMBED","PARAM","METER","PROGRESS"];n.IGNORE_TAGS=h;var f=function(){function n(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),!e)throw new Error("Missing anchor element");this.el=e,this.options=l({color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:function(){return!0},onBeforeHighlight:function(){return!0},onAfterHighlight:function(){}},t),(0,p.default)(this.el).addClass(this.options.contextClass),(0,r.bindEvents)(this.el,this)}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(n,[{key:"destroy",value:function(){(0,r.unbindEvents)(this.el,this),(0,p.default)(this.el).removeClass(this.options.contextClass)}},{key:"highlightHandler",value:function(){this.doHighlight()}},{key:"doHighlight",value:function(e){var t,n,r,i,o=(0,p.default)(this.el).getRange();o&&!o.collapsed&&(!0===this.options.onBeforeHighlight(o)&&(i=+new Date,(t=(0,v.createWrapper)(this.options)).setAttribute(d,i),n=this.highlightRangeCustom(o,t),r=this.normalizeHighlights(n),this.options.onAfterHighlight(o,r,i)),e||(0,p.default)(this.el).removeAllRanges())}},{key:"highlightRangeCustom",value:function(e,t){if(!e||e.collapsed)return[];console.log("ALSDebug29: RANGE: ",e);var n=[],r=t.cloneNode(!0),i=(0,v.getElementOffset)(e.startContainer,this.el)+e.startOffset,o=e.startContainer===e.endContainer?i+(e.endOffset-e.startOffset):(0,v.getElementOffset)(e.endContainer,this.el)+e.endOffset;console.log("ALSDebug29: startOffset: ",i,"endOffset: ",o),r.setAttribute(N,i),r.setAttribute(T,o),console.log("\n\n\n FINDING START CONTAINER FIRST TEXT NODE "),console.log("range.startContainer: ",e.startContainer);var l=(0,v.findTextNodeAtLocation)(e.startContainer,"start");console.log("\n\n\n FINDING END CONTAINER FIRST TEXT NODE "),console.log("range.endContainer: ",e.endContainer);var a=(0,v.findTextNodeAtLocation)(e.endContainer,"start");if(!l||!a)throw new Error("Failed to find the text node for the start or the end of the selected range");var s=e.endOffset<a.textContent.length-1?a.splitText(e.endOffset):a;if(l===a){var f=0<e.startOffset?l.splitText(e.startOffset):l;console.log("startContainer === endContainer!!!!!");var u=(0,p.default)(f).wrap(r);n.push(u)}else if(a.textContent.length>=e.endOffset){var d=l.splitText(e.startOffset),c=s.previousSibling;console.log("Node at the start of the new highlight: ",d),console.log("Node at the end of new highlight: ",c);var h=(0,v.findFirstNonSharedParent)({childElement:c,otherElement:d});if(h){var g=(0,v.extractElementContentForHighlight)({element:c,elementAncestor:h,options:this.options,locationInSelection:"end"});r.appendChild(d),g.classList.contains(this.options.highlightedClass)?g.childNodes.forEach(function(e){r.appendChild(e)}):r.appendChild(g),(0,p.default)(r).insertBefore(h),console.log("Node that is the wrapper of the end of the new highlight: ",h),console.log("Cloned of node that is the wrapper of the end of the new highlight after removing siblings and unwrapping highlight spans: ",g)}}return n}},{key:"highlightRange",value:function(e,t){if(!e||e.collapsed)return[];console.log("ALSDebug28: range before refined! ",e);for(var n,r,i,o=(0,v.refineRangeBoundaries)(e),l=o.startContainer,a=o.endContainer,s=o.goDeeper,f=!1,u=l,d=[];s&&u.nodeType===p.NODE_TYPE.TEXT_NODE&&(-1===h.indexOf(u.parentNode.tagName)&&""!==u.nodeValue.trim()&&((r=t.cloneNode(!0)).setAttribute(c,!0),i=u.parentNode,!(0,p.default)(this.el).contains(i)&&i!==this.el||(n=(0,p.default)(u).wrap(r),d.push(n))),s=!1),u!==a||a.hasChildNodes()&&s||(f=!0),u.tagName&&-1<h.indexOf(u.tagName)&&(a.parentNode===u&&(f=!0),s=!1),s&&u.hasChildNodes()?u=u.firstChild:s=u.nextSibling?(u=u.nextSibling,!0):(u=u.parentNode,!1),!f;);return d}},{key:"normalizeHighlights",value:function(e){var t;return e.forEach(function(e){(0,p.default)(e).normalizeTextNodes()}),t=e.filter(function(e){return e.parentElement?e:null}),(t=(0,i.unique)(t)).sort(function(e,t){return e.offsetTop-t.offsetTop||e.offsetLeft-t.offsetLeft}),t}},{key:"flattenNestedHighlights",value:function(f){var u=this;function e(){var s=!1;return f.forEach(function(e,t){var n=e.parentElement,r=n.previousSibling,i=n.nextSibling;if(u.isHighlight(n))if((0,v.haveSameColor)(n,e))n.replaceChild(e.firstChild,e),f[t]=n,s=!0;else{if(e.nextSibling||(i?(0,p.default)(e).insertBefore(i):(0,p.default)(e).insertAfter(n),s=!0),e.previousSibling||(r?(0,p.default)(e).insertAfter(r):(0,p.default)(e).insertBefore(n),s=!0),e.previousSibling&&3==e.previousSibling.nodeType&&e.nextSibling&&3==e.nextSibling.nodeType){var o=document.createElement("span");o.style.backgroundColor=n.style.backgroundColor,o.className=n.className;var l=n.attributes[d].nodeValue;o.setAttribute(d,l),o.setAttribute(c,!0);var a=o.cloneNode(!0);(0,p.default)(e.previousSibling).wrap(o),(0,p.default)(e.nextSibling).wrap(a),Array.prototype.slice.call(n.childNodes).forEach(function(e){(0,p.default)(e).insertBefore(e.parentNode)}),s=!0}n.hasChildNodes()||(0,p.default)(n).remove()}}),s}for((0,v.sortByDepth)(f,!0);e(););}},{key:"mergeSiblingHighlights",value:function(e){e.forEach(function(e){e.previousSibling,e.nextSibling;(0,p.default)(e).normalizeTextNodes()})}},{key:"setColor",value:function(e){this.options.color=e}},{key:"getColor",value:function(){return this.options.color}},{key:"removeHighlights",value:function(e){var t=e||this.el,n=this.getHighlights({container:t}),r=this;n.forEach(function(e){!0===r.options.onRemoveHighlight(e)&&function(e){e.className===t.className&&(0,p.default)(e).unwrap()}(e)})}},{key:"getHighlights",value:function(e){var t=(e=l({container:this.el,andSelf:!0,grouped:!1},e)).container.querySelectorAll("["+c+"]"),n=Array.prototype.slice.call(t);return!0===e.andSelf&&e.container.hasAttribute(c)&&n.push(e.container),e.grouped&&(n=(0,v.groupHighlights)(n,d)),n}},{key:"isHighlight",value:function(e){return e&&e.nodeType===p.NODE_TYPE.ELEMENT_NODE&&e.hasAttribute(c)}},{key:"serializeHighlights",value:function(){var e=this.getHighlights(),o=this.el,l=[];return(0,v.sortByDepth)(e,!1),e.forEach(function(e){var t=0,n=e.textContent.length,r=function(e,t){for(var n,r=[];n=Array.prototype.slice.call(e.parentNode.childNodes),r.unshift(n.indexOf(e)),(e=e.parentNode)!==t||!e;);return r}(e,o),i=e.cloneNode(!0);i.innerHTML="",i=i.outerHTML,e.previousSibling&&e.previousSibling.nodeType===p.NODE_TYPE.TEXT_NODE&&(t=e.previousSibling.length),l.push([i,e.textContent,r.join(":"),t,n])}),JSON.stringify(l)}},{key:"serializeHighlightsCustom",value:function(i){var e=this.getHighlights(),o=this.el,l=[];return(0,v.sortByDepth)(e,!1),e.forEach(function(e){var t=e.textContent.length,n=(0,v.getElementOffset)(e,o),r=e.cloneNode(!0);r.innerHTML="",r=r.outerHTML,console.log("Highlight text offset from root node: ",n),console.log("wrapper.toString().indexOf(".concat(i,"):"),r.toString().indexOf(i)),-1<r.toString().indexOf(i)&&l.push([r,e.textContent,n,t])}),JSON.stringify(l)}},{key:"deserializeHighlightsCustom",value:function(e){var t,s=[],f=this;if(!e)return s;try{t=JSON.parse(e)}catch(e){throw"Can't parse JSON: "+e}return t.forEach(function(e){try{console.log("Highlight: ",e),function(e){var t,n,r={wrapper:e[0],text:e[1],offset:Number.parseInt(e[2]),length:Number.parseInt(e[3])},i=f.el,o=(0,v.findNodeAndOffset)(r,i),l=o.node,a=o.offset;(t=l.splitText(a)).splitText(r.length),t.nextSibling&&!t.nextSibling.nodeValue&&(0,p.default)(t.nextSibling).remove(),t.previousSibling&&!t.previousSibling.nodeValue&&(0,p.default)(t.previousSibling).remove(),n=(0,p.default)(t).wrap((0,p.default)().fromHTML(r.wrapper)[0]),s.push(n)}(e)}catch(e){console&&console.warn&&console.warn("Can't deserialize highlight descriptor. Cause: "+e)}}),s}},{key:"deserializeHighlights",value:function(e){var t,a=[],s=this;if(!e)return a;try{t=JSON.parse(e)}catch(e){throw"Can't parse JSON: "+e}return t.forEach(function(e){try{!function(e){for(var t,n,r,i={wrapper:e[0],text:e[1],path:e[2].split(":"),offset:e[3],length:e[4]},o=i.path.pop(),l=s.el;r=i.path.shift();)l=l.childNodes[r];l.childNodes[o-1]&&l.childNodes[o-1].nodeType===p.NODE_TYPE.TEXT_NODE&&(o-=1),(t=(l=l.childNodes[o]).splitText(i.offset)).splitText(i.length),t.nextSibling&&!t.nextSibling.nodeValue&&(0,p.default)(t.nextSibling).remove(),t.previousSibling&&!t.previousSibling.nodeValue&&(0,p.default)(t.previousSibling).remove(),n=(0,p.default)(t).wrap((0,p.default)().fromHTML(i.wrapper)[0]),a.push(n)}(e)}catch(e){console&&console.warn&&console.warn("Can't deserialize highlight descriptor. Cause: "+e)}}),a}},{key:"find",value:function(e,t){var n=(0,p.default)(this.el).getWindow(),r=n.scrollX,i=n.scrollY,o=void 0===t||t;if((0,p.default)(this.el).removeAllRanges(),n.find)for(;n.find(e,o);)this.doHighlight(!0);else if(n.document.body.createTextRange){var l=n.document.body.createTextRange();for(l.moveToElementText(this.el);l.findText(e,1,o?4:0)&&((0,p.default)(this.el).contains(l.parentElement())||l.parentElement()===this.el);)l.select(),this.doHighlight(!0),l.collapse(!1)}(0,p.default)(this.el).removeAllRanges(),n.scrollTo(r,i)}}]),n}();n.default=f},{"./utils/arrays":4,"./utils/dom":5,"./utils/events":6,"./utils/highlights":7}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.unique=function(e){return e.filter(function(e,t,n){return n.indexOf(e)===t})}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.NODE_TYPE=void 0;var r={ELEMENT_NODE:1,TEXT_NODE:3};n.NODE_TYPE=r;function o(i){return{addClass:function(e){i.classList?i.classList.add(e):i.className+=" "+e},removeClass:function(e){i.classList?i.classList.remove(e):i.className=i.className.replace(new RegExp("(^|\\b)"+e+"(\\b|$)","gi")," ")},prepend:function(e){for(var t=Array.prototype.slice.call(e),n=t.length;n--;)i.insertBefore(t[n],i.firstChild)},append:function(e){for(var t=Array.prototype.slice.call(e),n=0,r=t.length;n<r;++n)i.appendChild(t[n])},insertAfter:function(e){return e.parentNode.insertBefore(i,e.nextSibling)},insertBefore:function(e){return e.parentNode.insertBefore(i,e)},remove:function(){i.parentNode.removeChild(i),i=null},contains:function(e){return i!==e&&i.contains(e)},wrap:function(e){return i.parentNode&&i.parentNode.insertBefore(e,i),e.appendChild(i),e},unwrap:function(){var t,e=Array.prototype.slice.call(i.childNodes);return e.forEach(function(e){t=e.parentNode,o(e).insertBefore(e.parentNode)}),o(t).remove(),e},parents:function(){for(var e,t=[];e=i.parentNode;)t.push(e),i=e;return t},parentsWithoutDocument:function(){return this.parents().filter(function(e){return e!==document})},normalizeTextNodes:function(){if(i){if(i.nodeType===r.TEXT_NODE)for(;i.nextSibling&&i.nextSibling.nodeType===r.TEXT_NODE;)i.nodeValue+=i.nextSibling.nodeValue,i.parentNode.removeChild(i.nextSibling);else o(i.firstChild).normalizeTextNodes();o(i.nextSibling).normalizeTextNodes()}},color:function(){return i.style.backgroundColor},fromHTML:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes},getRange:function(){var e,t=o(i).getSelection();return 0<t.rangeCount&&(e=t.getRangeAt(0)),e},removeAllRanges:function(){o(i).getSelection().removeAllRanges()},getSelection:function(){return o(i).getWindow().getSelection()},getWindow:function(){return o(i).getDocument().defaultView},getDocument:function(){return i.ownerDocument||i}}}n.default=o},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bindEvents=function(e,t){e.addEventListener("mouseup",t.highlightHandler.bind(t)),e.addEventListener("touchend",t.highlightHandler.bind(t))},n.unbindEvents=function(e,t){e.removeEventListener("mouseup",t.highlightHandler.bind(t)),e.removeEventListener("touchend",t.highlightHandler.bind(t))}},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.refineRangeBoundaries=function(e){var t=e.startContainer,n=e.endContainer,r=e.commonAncestorContainer,i=!0;if(0===e.endOffset){for(;!n.previousSibling&&n.parentNode!==r;)n=n.parentNode;n=n.previousSibling}else n.nodeType===f.NODE_TYPE.TEXT_NODE?e.endOffset<n.nodeValue.length&&n.splitText(e.endOffset):0<e.endOffset&&(n=n.childNodes.item(e.endOffset-1));t.nodeType===f.NODE_TYPE.TEXT_NODE?e.startOffset===t.nodeValue.length?i=!1:0<e.startOffset&&(t=t.splitText(e.startOffset),n===t.previousSibling&&(n=t)):t=e.startOffset<t.childNodes.length?t.childNodes.item(e.startOffset):t.nextSibling;return{startContainer:t,endContainer:n,goDeeper:i}},n.sortByDepth=function(e,n){e.sort(function(e,t){return(0,f.default)(n?t:e).parents().length-(0,f.default)(n?e:t).parents().length})},n.haveSameColor=function(e,t){return(0,f.default)(e).color()===(0,f.default)(t).color()},n.createWrapper=function(e){var t=document.createElement("span");return t.style.backgroundColor=e.color,t.className=e.highlightedClass,t},n.findTextNodeAtLocation=u,n.findNodeAndOffset=function(e,t){var n=t,r=0,i=0,o=!1;for(;n&&!o&&(r<e.offset||r===e.offset&&0<n.childNodes.length);){var l=r+n.textContent.length;l>e.offset?0===n.childNodes.length?(i=e.offset-r,o=!0,r+=i):n=n.childNodes[0]:(r=l,n=n.nextSibling)}return{node:n,offset:i}},n.getElementOffset=function(e,t){var n,r=0,i=e;do{var o=(n=Array.prototype.slice.call(i.parentNode.childNodes)).indexOf(i),l=a(n,o);r+=l,i=i.parentNode,1}while(i!==t||!i);return r},n.findFirstNonSharedParent=function(e){var t=e.childElement,n=e.otherElement,r=(0,f.default)(t).parentsWithoutDocument(),i=0,o=null;for(;!o&&i<r.length;){var l=r[i];l.contains(n)&&0<i&&(console.log("currentParent contains other element!",l),o=r[i-1]),i++}return o},n.extractElementContentForHighlight=function(e){var t=e.element,n=e.elementAncestor,r=e.options,i=e.locationInSelection,o=n.cloneNode(!0),l=u(o,"start"===i?"end":"start"),a=l.parentNode,s=l.nextSibling;for(;s;)a.removeChild(s),s=l.nextSibling;console.log("elementCopy: ",l),console.log("elementCopyParent: ",a),a!==o&&a.classList.contains(r.highlightedClass)&&(0,f.default)(a).unwrap();return t.parentNode.removeChild(t),o},n.groupHighlights=function(e,n){var r=[],i={},o=[];return e.forEach(function(e){var t=e.getAttribute(n);void 0===i[t]&&(i[t]=[],r.push(t)),i[t].push(e)}),r.forEach(function(e){var t=i[e];o.push({chunks:t,timestamp:e,toString:function(){return t.map(function(e){return e.textContent}).join("")}})}),o};var f=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}}(e("./dom"));function u(e,t){console.log("Element as parameter: ",e);for(var n=e,r=0;n&&n.nodeType!==f.NODE_TYPE.TEXT_NODE;){if(console.log("textNodeElement step ".concat(r),n),"start"===t)n=0<n.childNodes.length?n.childNodes[0]:n.nextSibling;else if("end"===t)if(0<n.childNodes.length){var i=n.childNodes.length-1;n=n.childNodes[i]}else n=n.previousSibling;else n=null;r++}return console.log("text node element returned: ",n),n}function a(e,t){for(var n=0,r=0;r<t;r++){var i=e[r].textContent;i&&0<i.length&&(n+=i.length)}return n}},{"./dom":5}]},{},[1]);